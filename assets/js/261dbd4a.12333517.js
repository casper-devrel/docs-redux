"use strict";(self.webpackChunkcspr_docs=self.webpackChunkcspr_docs||[]).push([[9899],{38123:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>b,frontMatter:()=>d,metadata:()=>i,toc:()=>o});var t=a(74848),c=a(28453);const d={title:"Contract-Level Events"},s="Enabling Contracts to Emit Events",i={id:"developers/writing-onchain-code/emitting-contract-events",title:"Contract-Level Events",description:"Smart contracts can be programmed to emit messages while executing. Under certain conditions, an off-chain dApp may listen to these events and react as described in Monitoring and Consuming Events.",source:"@site/docs/developers/writing-onchain-code/emitting-contract-events.md",sourceDirName:"developers/writing-onchain-code",slug:"/developers/writing-onchain-code/emitting-contract-events",permalink:"/docs-redux/next/developers/writing-onchain-code/emitting-contract-events",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Contract-Level Events"},sidebar:"developers",previous:{title:"Testing Session Code",permalink:"/docs-redux/next/developers/writing-onchain-code/testing-session-code"},next:{title:"Contract Hash vs. Package Hash",permalink:"/docs-redux/next/developers/writing-onchain-code/contract-hash-vs-package-hash"}},r={},o=[{value:"Creating a Topic",id:"creating-a-topic",level:2},{value:"Verifying a Topic",id:"verifying-a-topic",level:2},{value:"Emitting a Message",id:"emitting-a-message",level:2},{value:"Verifying a Message",id:"verifying-a-message",level:2},{value:"Querying global state",id:"querying-global-state",level:3},{value:"Costs and Chainspec Settings",id:"costs-and-chainspec-settings",level:2},{value:"Topic Management during Contract Upgrades",id:"topic-management-during-contract-upgrades",level:2},{value:"What&#39;s Next?",id:"whats-next",level:2}];function f(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",details:"details",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",summary:"summary",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"enabling-contracts-to-emit-events",children:"Enabling Contracts to Emit Events"})}),"\n",(0,t.jsxs)(n.p,{children:["Smart contracts can be programmed to emit messages while executing. Under certain conditions, an off-chain dApp may listen to these events and react as described in ",(0,t.jsx)(n.a,{href:"/docs-redux/next/developers/dapps/monitor-and-consume-events",children:"Monitoring and Consuming Events"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Messages produced by smart contracts are visible on a node's SSE event stream in human-readable format, and they contain the following information:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The address of the entity that produced the message, i.e., the contract hash"}),"\n",(0,t.jsx)(n.li,{children:"The message topic used to categorize the message"}),"\n",(0,t.jsx)(n.li,{children:"The human-readable message string"}),"\n",(0,t.jsx)(n.li,{children:"The index identifying the message in a message array"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["A checksum of the message is permanently stored in global state to protect against message spoofing and repudiation. For more details regarding the design and implementation of this feature, read the corresponding ",(0,t.jsx)(n.a,{href:"https://github.com/casper-network/ceps/pull/88",children:"CEP-88 documentation"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.a,{href:"https://docs.rs/casper-contract/latest/casper_contract/ext_ffi/index.html",children:"Casper External FFI"})," provides the following two runtime functions to manage and emit messages:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"manage_message_topic"})," - Creates a topic to help categorize messages. When used for the first time, this function registers the contract's intent to emit messages. The maximum number of topics is specified in the chainspec. "]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"emit_message"})," - Emits a human-readable string message under a pre-registered topic."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The following sections contain more details about using these functions."}),"\n",(0,t.jsx)(n.h2,{id:"creating-a-topic",children:"Creating a Topic"}),"\n",(0,t.jsxs)(n.p,{children:["To create a new topic, call the ",(0,t.jsx)(n.code,{children:"manage_message_topic"})," runtime function. "]}),"\n",(0,t.jsxs)(n.p,{children:["This sample code  adds a new message topic called ",(0,t.jsx)(n.code,{children:"EVENTS_TOPIC"}),", on which the contract can emit messages:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:"runtime::manage_message_topic(EVENTS_TOPIC, MessageTopicOperation::Add).unwrap_or_revert();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"verifying-a-topic",children:"Verifying a Topic"}),"\n",(0,t.jsxs)(n.p,{children:["No SSE event is emitted when a contract creates a new message topic. However, some applications need to determine which message topics are available to listen to messages on those topics. In global state, each contract entity contains a field called ",(0,t.jsx)(n.code,{children:"message_topics"}),", which stores a map of registered topic names by topic name hash:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"message_topics": [\n    {\n    "topic_name": "events",\n    "topic_name_hash": "topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1"\n    }\n]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["You can view the contract using the Casper CLI client and the ",(0,t.jsx)(n.code,{children:"query-global-state"})," command using the block identifier or the state root hash:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"casper-client query-global-state \\\n--node-address <HOST:PORT> \\\n--key [HASH_STRING] \\\n--block-identifier <BLOCK_HASH> \\\n"})}),"\n",(0,t.jsx)(n.p,{children:"The arguments used above are:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node-address"})," - An IP address of a peer on the network. The default port for JSON-RPC servers on Mainnet and Testnet is 7777."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"key"})," - The identifier for the query. Use the key that identifies the contract, e.g., addressable-entity-contract-HASH."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"block-identifier"})," - Hex-encoded block hash or height of the block."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here is a sample query to view the contract:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'casper-client query-global-state \\\n--node-address http://127.0.0.1:11101 \\\n--key "addressable-entity-contract-b51b0f9d94e5744af4dce6b4a9990c5f3e652c1a0a946e680e83f97d8846eff5" \\\n--block-identifier 58d26bf0eeeefb698d76b319014efd2eaa2198ad754a489a23131948ef41fdd2\n'})}),"\n",(0,t.jsxs)(n.details,{children:["\n",(0,t.jsx)(n.summary,{children:"Expand to view the sample contract"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "id": -4994937296370433409,\n  "result": {\n    "api_version": "1.0.0",\n    "block_header": {\n      "Version2": {\n        "parent_hash": "deafd8e5c1aff47ae8528fa2d343b711c2f5cb18ee29527961b37d4d173ad42a",\n        "state_root_hash": "96d8962c03899277f9a4bd667c0510c0eab490dd6253ae0b8cee4ebfbcd52be6",\n        "body_hash": "28812ec460ab82f94f3c658e946bb4779c6b76dea9c55d18beaf1e47fe8dd9c9",\n        "random_bit": false,\n        "accumulated_seed": "96a09ea136bb7e4e99b039ee0f1f6d9dd88d663927faffc7eb5c60804056354c",\n        "era_end": null,\n        "timestamp": "2023-11-28T23:59:53.856Z",\n        "era_id": 112,\n        "height": 1066,\n        "protocol_version": "1.0.0"\n      }\n    },\n    "stored_value": {\n      "AddressableEntity": {\n        "package_hash": "contract-package-66cf48b3ccf32269ccc5d93059eef461bcf2c8b2460309ff3a442190688d5275",\n        "byte_code_hash": "contract-wasm-23e042b941e45ea7fe4f81496fd778349f2002b2f786f9fddbdd1298450b60ad",\n        "named_keys": [\n          {\n            "name": "acl_package_mode",\n            "key": "uref-2a088bc6c30d1499cd9348d388a03c8162ab26d09b0484f634e6f4022581fe99-007"\n          },\n          {\n            "name": "acl_whitelist",\n            "key": "uref-d17ecf3fe6e46f9a6063cfb31cdb03cdd6b99d095b71d2247319c293f864c4d1-007"\n          },\n          {\n            "name": "allow_minting",\n            "key": "uref-c737324d1caa1885ad0f22f628933cfce91400ea259147186d330cf167eb6843-007"\n          },\n          {\n            "name": "approved",\n            "key": "uref-87a0de173fd6a56fb867bab46d8a508a43259a244ffdd8b0d98e5c286261f9af-007"\n          },\n          {\n            "name": "balances",\n            "key": "uref-0c08f3df6e05e509000cd57646b98983481b8bcd46b98f0aae1a5abccc1e114f-007"\n          },\n          {\n            "name": "burn_mode",\n            "key": "uref-e507551382a6217b9165dd222854e6c877d33eab9845c4b7e8444559303e5b8a-007"\n          },\n          {\n            "name": "burnt_tokens",\n            "key": "uref-4711c3ee36ac9639af509f45164fdb5a88692b109c3b2360e57d09fcdd702f63-007"\n          },\n          {\n            "name": "cep78_CEP-78",\n            "key": "uref-a02fc32366a7187448afb8263a8f3716e933d28d84db6c6403893d94917cf98d-007"\n          },\n          {\n            "name": "collection_name",\n            "key": "uref-89e904724d79a9f6d41958a3621b437c9e220ad081805f39040ff51c79a8d67c-007"\n          },\n          {\n            "name": "collection_symbol",\n            "key": "uref-d41a40789a84cc8e0314135695acc279875d6c7455daafe517cc4ae5329d95de-007"\n          },\n          {\n            "name": "events_mode",\n            "key": "uref-d950666b546fe7afcf123f833ba4166b395c03bdbfd5de86dab051af3c1cdac0-007"\n          },\n          {\n            "name": "hash_by_index",\n            "key": "uref-7c9751097762ad778a6a11151780d377cbc57e0807e289d278831ca9263aa844-007"\n          },\n          {\n            "name": "holder_mode",\n            "key": "uref-e7acd748f4f82e609aa49f577e78e1ce6b1ab1dad5b5b1b59c8ff965598a6f34-007"\n          },\n          {\n            "name": "identifier_mode",\n            "key": "uref-bf32824dddf12dd16668581211ed22bef4b36c22db0165bde4986508f363940e-007"\n          },\n          {\n            "name": "index_by_hash",\n            "key": "uref-e67fecb85654def8b1440907728491f4f1ae125a97f3fed93872c075e6fb4ad5-007"\n          },\n          {\n            "name": "installer",\n            "key": "account-hash-212ffdd040b65495419f4057c8392930e410f7bf24baeec8de59a6117b63e45c"\n          },\n          {\n            "name": "json_schema",\n            "key": "uref-f8b2f63a4c69a84c795908e9abd0f66b857790b8df627a21336d6d1e07bf7103-007"\n          },\n          {\n            "name": "metadata_cep78",\n            "key": "uref-5cf8084639c2b7b8f54ab78700e0a82107c0bb28966cdc3ffdd4bd0877a47f64-007"\n          },\n          {\n            "name": "metadata_custom_validated",\n            "key": "uref-f5ce01c02a1942a4833159d72414c014b0838b607b4f419af9e19cd2fb123658-007"\n          },\n          {\n            "name": "metadata_mutability",\n            "key": "uref-c11c8e99c52477efaae636890a49625f54e32b832e23e288e00952c8bf34610a-007"\n          },\n          {\n            "name": "metadata_nft721",\n            "key": "uref-d39ee0c77f9864b05297ac504ee5919d60dddb6c8c0d6ccce8225801885f8972-007"\n          },\n          {\n            "name": "metadata_raw",\n            "key": "uref-dc660363cb2b4dfea2c01d8c3bf2258a3700fb6c830d13972ff206e330fd791a-007"\n          },\n          {\n            "name": "minting_mode",\n            "key": "uref-962f6e020971031eb1bdd37f705df498cd4ee90c15aae901df9654a10461184d-007"\n          },\n          {\n            "name": "nft_kind",\n            "key": "uref-001ffa305e021b5d411a3e04707b3c17f0d31ee400e6c5faa9b8f66e0ebfdc99-007"\n          },\n          {\n            "name": "nft_metadata_kind",\n            "key": "uref-8dfb98ccdd030aae1e0dcda03dc728dd4332eb18c945fd25a55b43f9e487141e-007"\n          },\n          {\n            "name": "nft_metadata_kinds",\n            "key": "uref-cb9799861587032b55d391604c8a9f016d1237b0b600413d6c050da3e0fc81d1-007"\n          },\n          {\n            "name": "number_of_minted_tokens",\n            "key": "uref-cd0871a7e69b91a05dbf81068115e45380de3a35bd2258369e3a24b7958cd77f-007"\n          },\n          {\n            "name": "operator_burn_mode",\n            "key": "uref-40977d32bbfb85454c9e7b5ca03192efcd406f228d5c2e593210b3960e05604e-007"\n          },\n          {\n            "name": "operators",\n            "key": "uref-cbcb06403fbd8cb9f397029718f1f7e66bf5ec4e33aa58315dd3d5ecf5d078a7-007"\n          },\n          {\n            "name": "ownership_mode",\n            "key": "uref-bba9996be36b1526113a0aaa030db658edd3c8719a60d55b35b7312f01f2e6da-007"\n          },\n          {\n            "name": "package_operator_mode",\n            "key": "uref-c05e3e87f5a64fbc20615afffaa6e4c81d98431b698f681322f5d8730ff40590-007"\n          },\n          {\n            "name": "page_table",\n            "key": "uref-4c545e6e4860629fd138fcb91f24d21498e69b076d472660ff769dfc2a994301-007"\n          },\n          {\n            "name": "receipt_name",\n            "key": "uref-6ddba59f56a5d52df5b8f85d03d19003feec3307a9d9ac6b420486d1a440a586-007"\n          },\n          {\n            "name": "reporting_mode",\n            "key": "uref-b6c48cfa2fa090b71912b209638b33bbf8b670a8d8a1065d73b54c70f5cc414c-007"\n          },\n          {\n            "name": "rlo_mflag",\n            "key": "uref-d520d8cbca2b28a42f0db9493e94bdbb93f74702e20eac1a77b48dda39367afe-007"\n          },\n          {\n            "name": "token_issuers",\n            "key": "uref-c1993c045f9e656b4bcb40639705d232cb6ecb4a2c6a04aeb33baffe9869cb9a-007"\n          },\n          {\n            "name": "token_owners",\n            "key": "uref-1cabd90eac707493056418a62d8b82057af0d7c1e1b90d6139a46120fff4187d-007"\n          },\n          {\n            "name": "total_token_supply",\n            "key": "uref-09b6f0901eb8cd9c6272be8199aeff4c6f5d2e3989980b548dbd595b40c033bf-007"\n          },\n          {\n            "name": "whitelist_mode",\n            "key": "uref-af7ba884bbddf91530279c0ea005c56a4951f5330ebe5395528471302b791b3e-007"\n          }\n        ],\n        "entry_points": [\n          {\n            "name": "approve",\n            "entry_point": {\n              "name": "approve",\n              "args": [\n                {\n                  "name": "spender",\n                  "cl_type": "Key"\n                }\n              ],\n              "ret": "Unit",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "balance_of",\n            "entry_point": {\n              "name": "balance_of",\n              "args": [\n                {\n                  "name": "token_owner",\n                  "cl_type": "Key"\n                }\n              ],\n              "ret": "U64",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "burn",\n            "entry_point": {\n              "name": "burn",\n              "args": [],\n              "ret": "Unit",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "get_approved",\n            "entry_point": {\n              "name": "get_approved",\n              "args": [],\n              "ret": {\n                "Option": "Key"\n              },\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "init",\n            "entry_point": {\n              "name": "init",\n              "args": [\n                {\n                  "name": "collection_name",\n                  "cl_type": "String"\n                },\n                {\n                  "name": "collection_symbol",\n                  "cl_type": "String"\n                },\n                {\n                  "name": "total_token_supply",\n                  "cl_type": "U64"\n                },\n                {\n                  "name": "allow_minting",\n                  "cl_type": "Bool"\n                },\n                {\n                  "name": "minting_mode",\n                  "cl_type": "U8"\n                },\n                {\n                  "name": "ownership_mode",\n                  "cl_type": "U8"\n                },\n                {\n                  "name": "nft_kind",\n                  "cl_type": "U8"\n                },\n                {\n                  "name": "holder_mode",\n                  "cl_type": "U8"\n                },\n                {\n                  "name": "whitelist_mode",\n                  "cl_type": "U8"\n                },\n                {\n                  "name": "acl_whitelist",\n                  "cl_type": {\n                    "List": "Key"\n                  }\n                },\n                {\n                  "name": "acl_package_mode",\n                  "cl_type": "Bool"\n                },\n                {\n                  "name": "package_operator_mode",\n                  "cl_type": "Bool"\n                },\n                {\n                  "name": "json_schema",\n                  "cl_type": "String"\n                },\n                {\n                  "name": "receipt_name",\n                  "cl_type": "String"\n                },\n                {\n                  "name": "identifier_mode",\n                  "cl_type": "U8"\n                },\n                {\n                  "name": "burn_mode",\n                  "cl_type": "U8"\n                },\n                {\n                  "name": "operator_burn_mode",\n                  "cl_type": "Bool"\n                },\n                {\n                  "name": "nft_metadata_kind",\n                  "cl_type": "U8"\n                },\n                {\n                  "name": "metadata_mutability",\n                  "cl_type": "U8"\n                },\n                {\n                  "name": "owner_reverse_lookup_mode",\n                  "cl_type": "U8"\n                },\n                {\n                  "name": "events_mode",\n                  "cl_type": "U8"\n                },\n                {\n                  "name": "transfer_filter_contract",\n                  "cl_type": {\n                    "Option": "Key"\n                  }\n                }\n              ],\n              "ret": "Unit",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "is_approved_for_all",\n            "entry_point": {\n              "name": "is_approved_for_all",\n              "args": [\n                {\n                  "name": "token_owner",\n                  "cl_type": "Key"\n                },\n                {\n                  "name": "operator",\n                  "cl_type": "Key"\n                }\n              ],\n              "ret": "Bool",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "metadata",\n            "entry_point": {\n              "name": "metadata",\n              "args": [],\n              "ret": "String",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "migrate",\n            "entry_point": {\n              "name": "migrate",\n              "args": [\n                {\n                  "name": "cep78_package_key",\n                  "cl_type": "Any"\n                }\n              ],\n              "ret": "Unit",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "mint",\n            "entry_point": {\n              "name": "mint",\n              "args": [\n                {\n                  "name": "token_owner",\n                  "cl_type": "Key"\n                },\n                {\n                  "name": "token_meta_data",\n                  "cl_type": "String"\n                }\n              ],\n              "ret": {\n                "Tuple3": [\n                  "String",\n                  "Key",\n                  "String"\n                ]\n              },\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "owner_of",\n            "entry_point": {\n              "name": "owner_of",\n              "args": [],\n              "ret": "Key",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "register_owner",\n            "entry_point": {\n              "name": "register_owner",\n              "args": [],\n              "ret": {\n                "Tuple2": [\n                  "String",\n                  "URef"\n                ]\n              },\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "revoke",\n            "entry_point": {\n              "name": "revoke",\n              "args": [],\n              "ret": "Unit",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "set_approval_for_all",\n            "entry_point": {\n              "name": "set_approval_for_all",\n              "args": [\n                {\n                  "name": "approve_all",\n                  "cl_type": "Bool"\n                },\n                {\n                  "name": "operator",\n                  "cl_type": "Key"\n                }\n              ],\n              "ret": "Unit",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "set_token_metadata",\n            "entry_point": {\n              "name": "set_token_metadata",\n              "args": [\n                {\n                  "name": "token_meta_data",\n                  "cl_type": "String"\n                }\n              ],\n              "ret": "Unit",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "set_variables",\n            "entry_point": {\n              "name": "set_variables",\n              "args": [\n                {\n                  "name": "allow_minting",\n                  "cl_type": "Bool"\n                },\n                {\n                  "name": "contract_whitelist",\n                  "cl_type": {\n                    "List": {\n                      "ByteArray": 32\n                    }\n                  }\n                },\n                {\n                  "name": "acl_whitelist",\n                  "cl_type": {\n                    "List": "Key"\n                  }\n                },\n                {\n                  "name": "acl_package_mode",\n                  "cl_type": "Bool"\n                },\n                {\n                  "name": "package_operator_mode",\n                  "cl_type": "Bool"\n                },\n                {\n                  "name": "operator_burn_mode",\n                  "cl_type": "Bool"\n                }\n              ],\n              "ret": "Unit",\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "transfer",\n            "entry_point": {\n              "name": "transfer",\n              "args": [\n                {\n                  "name": "source_key",\n                  "cl_type": "Key"\n                },\n                {\n                  "name": "target_key",\n                  "cl_type": "Key"\n                }\n              ],\n              "ret": {\n                "Tuple2": [\n                  "String",\n                  "Key"\n                ]\n              },\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          },\n          {\n            "name": "updated_receipts",\n            "entry_point": {\n              "name": "updated_receipts",\n              "args": [],\n              "ret": {\n                "List": {\n                  "Tuple2": [\n                    "String",\n                    "Key"\n                  ]\n                }\n              },\n              "access": "Public",\n              "entry_point_type": "AddressableEntity"\n            }\n          }\n        ],\n        "protocol_version": "1.0.0",\n        "main_purse": "uref-596d134ad1078315a5e0cd2f40802b65cf53b6c789f0a38ba04157d04e15ab2b-007",\n        "associated_keys": [\n          {\n            "account_hash": "account-hash-212ffdd040b65495419f4057c8392930e410f7bf24baeec8de59a6117b63e45c",\n            "weight": 1\n          }\n        ],\n        "action_thresholds": {\n          "deployment": 1,\n          "upgrade_management": 1,\n          "key_management": 1\n        },\n        "message_topics": [\n          {\n            "topic_name": "events",\n            "topic_name_hash": "topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1"\n          }\n        ]\n      }\n    },\n    "merkle_proof": "[8288 hex chars]"\n  }\n}\n'})}),"\n"]}),"\n",(0,t.jsx)(n.br,{}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsxs)(n.p,{children:["Under ",(0,t.jsx)(n.code,{children:"message_topics"}),", you will find the control record for that topic, which has a composite key derived from the caller's entity address and the hash of the topic name:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"message_topics": [\n  {\n    "topic_name": "events",\n    "topic_name_hash": "topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1"\n  }\n]\n'})}),"\n",(0,t.jsx)(n.h2,{id:"emitting-a-message",children:"Emitting a Message"}),"\n",(0,t.jsxs)(n.p,{children:["To emit a message on a previously-created topic, call the ",(0,t.jsx)(n.code,{children:"emit_message"})," runtime function. "]}),"\n",(0,t.jsxs)(n.p,{children:["This sample code  sends a new message on the topic ",(0,t.jsx)(n.code,{children:"EVENTS_TOPIC"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:"runtime::emit_message(EVENTS_TOPIC, &message.try_into().unwrap()).unwrap_or_revert();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"verifying-a-message",children:"Verifying a Message"}),"\n",(0,t.jsxs)(n.p,{children:["To verify a message, check a node's SSE endpoint, which streams messages in a human-readable format. Messages are visible as part of the ",(0,t.jsx)(n.code,{children:"TransactionProcessed"})," event after the corresponding block is processed and added to the blockchain. The messages sent out on the event stream contain the following:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The identity of the entity that produced the message"}),"\n",(0,t.jsx)(n.li,{children:"The payload of the message"}),"\n",(0,t.jsx)(n.li,{children:"The name of the topic on which the message was emitted"}),"\n",(0,t.jsx)(n.li,{children:"The blake2b hash of the topic name"}),"\n",(0,t.jsx)(n.li,{children:"The message index in the topic"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The following is a sample message logged inside a ",(0,t.jsx)(n.code,{children:"TransactionProcessed"})," event:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"messages": [\n    {\n        "entity_addr": "addressable-entity-b51b0f9d94e5744af4dce6b4a9990c5f3e652c1a0a946e680e83f97d8846eff5",\n        "message": {\n            "String": "{\\"Mint\\":{\\"recipient\\":\\"account-hash-212ffdd040b65495419f4057c8392930e410f7bf24baeec8de59a6117b63e45c\\",\\"token_id\\":{\\"Index\\":0}}}"\n        },\n        "topic_name": "events",\n        "topic_name_hash": "topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1",\n        "index": 0\n    }\n]\n'})}),"\n",(0,t.jsxs)(n.details,{children:["\n",(0,t.jsx)(n.summary,{children:"Expand to view the full TransactionProcessed message"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'data: {\n    "TransactionProcessed": {\n        "transaction_hash": {\n            "Deploy": "09b90ada8b456e342f3209b3330c1d3bba0452d453c7f37106fed9799b280e26"\n        },\n        "account": "0130a16c8b0918cbfa8da00b6c0910ae0f2799dfd5ef7f092d0c4c1688031d60ac",\n        "timestamp": "2023-11-29T01:35:41.522Z",\n        "ttl": "30m",\n        "block_hash": "b90c61cd1e3bc3be36110f04a7aec97b22bcfe9f36291cb011a14c4a663753bd",\n        "execution_result": {\n            "Version2": {\n                "Success": {\n                    "effects": [\n                        {\n                            "key": "account-hash-212ffdd040b65495419f4057c8392930e410f7bf24baeec8de59a6117b63e45c",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "package-c092060112b445d1706f6962d7ad2da72a2e8312000e99d2b58f6a3e1624649a",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f4952351cd81d38e205cd31a938b802241b70ac539d0fba5c5d2e0dc825f8944",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f4952351cd81d38e205cd31a938b802241b70ac539d0fba5c5d2e0dc825f8944",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f4952351cd81d38e205cd31a938b802241b70ac539d0fba5c5d2e0dc825f8944",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "package-42c6bbc82e3fc9dc4f890f507812a49c19aa998ed09b9d97996d9257e3c8c1c1",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f4952351cd81d38e205cd31a938b802241b70ac539d0fba5c5d2e0dc825f8944",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f5a58fd26fb2200445eb04363affcc1240cb9e1882c6a86612de41e06e1082d1",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f5a58fd26fb2200445eb04363affcc1240cb9e1882c6a86612de41e06e1082d1",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "package-aabcd5869e1e47a6e66ca2430fcabbe9687241e55e0a070204b150771f7aef74",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f5a58fd26fb2200445eb04363affcc1240cb9e1882c6a86612de41e06e1082d1",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "balance-cfe2039aa5f3eca8a00d3444c4421e2034b77330d614b0c47c47d6af09113861",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "balance-278862691b1d6698c02c82b302aa391f1cd10a3637e4a8c633b4560917bc607b",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "balance-cfe2039aa5f3eca8a00d3444c4421e2034b77330d614b0c47c47d6af09113861",\n                            "kind": {\n                                "Write": {\n                                    "CLValue": {\n                                        "cl_type": "U512",\n                                        "bytes": "0e9a6a8aff995ac138938d44c64d31",\n                                        "parsed": "999999999999999999999518955956890"\n                                    }\n                                }\n                            }\n                        },\n                        {\n                            "key": "balance-278862691b1d6698c02c82b302aa391f1cd10a3637e4a8c633b4560917bc607b",\n                            "kind": {\n                                "AddUInt512": "7500000000"\n                            }\n                        },\n                        {\n                            "key": "addressable-entity-contract-b51b0f9d94e5744af4dce6b4a9990c5f3e652c1a0a946e680e83f97d8846eff5",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "package-66cf48b3ccf32269ccc5d93059eef461bcf2c8b2460309ff3a442190688d5275",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "byte-code-v1-wasm-23e042b941e45ea7fe4f81496fd778349f2002b2f786f9fddbdd1298450b60ad",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "uref-c737324d1caa1885ad0f22f628933cfce91400ea259147186d330cf167eb6843-000",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "uref-09b6f0901eb8cd9c6272be8199aeff4c6f5d2e3989980b548dbd595b40c033bf-000",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "uref-cd0871a7e69b91a05dbf81068115e45380de3a35bd2258369e3a24b7958cd77f-000",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "uref-962f6e020971031eb1bdd37f705df498cd4ee90c15aae901df9654a10461184d-000",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "uref-e7acd748f4f82e609aa49f577e78e1ce6b1ab1dad5b5b1b59c8ff965598a6f34-000",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "uref-cb9799861587032b55d391604c8a9f016d1237b0b600413d6c050da3e0fc81d1-000",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "uref-bf32824dddf12dd16668581211ed22bef4b36c22db0165bde4986508f363940e-000",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "dictionary-79bb2f90d7ab9cef266efe53e70722dc6e4fa56372ce8cd859b89cec3ff05307",\n                            "kind": {\n                                "Write": {\n                                    "CLValue": {\n                                        "cl_type": "Any",\n                                        "bytes": "8f0000008b0000007b226e616d65223a20224a6f686e20446f65222c22746f6b656e5f757269223a202268747470733a5c2f5c2f7777772e626172666f6f2e636f6d222c22636865636b73756d223a202239343062666662336632626261333566383433313361613236646130396563653361643437303435633661313239326332626264326466346162316135356662227d0a20000000dc660363cb2b4dfea2c01d8c3bf2258a3700fb6c830d13972ff206e330fd791a0100000030",\n                                        "parsed": null\n                                    }\n                                }\n                            }\n                        },\n                        {\n                            "key": "uref-bba9996be36b1526113a0aaa030db658edd3c8719a60d55b35b7312f01f2e6da-000",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "dictionary-203953bdea81a8373a987786d74eb94d8626c401a28625bb66c006079fd2bde7",\n                            "kind": {\n                                "Write": {\n                                    "CLValue": {\n                                        "cl_type": "Any",\n                                        "bytes": "2100000000212ffdd040b65495419f4057c8392930e410f7bf24baeec8de59a6117b63e45c0b200000001cabd90eac707493056418a62d8b82057af0d7c1e1b90d6139a46120fff4187d0100000030",\n                                        "parsed": null\n                                    }\n                                }\n                            }\n                        },\n                        {\n                            "key": "dictionary-453603548bb0d677edaa9bbc014bff6e30801a8d86eb85f884ad08e874fdc0f1",\n                            "kind": {\n                                "Write": {\n                                    "CLValue": {\n                                        "cl_type": "Any",\n                                        "bytes": "2100000000212ffdd040b65495419f4057c8392930e410f7bf24baeec8de59a6117b63e45c0b20000000c1993c045f9e656b4bcb40639705d232cb6ecb4a2c6a04aeb33baffe9869cb9a0100000030",\n                                        "parsed": null\n                                    }\n                                }\n                            }\n                        },\n                        {\n                            "key": "dictionary-3344eae47d44ef595de8219a32c69e9ac51ee14f020bd5da24f899fd49d12abf",\n                            "kind": {\n                                "Write": {\n                                    "CLValue": {\n                                        "cl_type": "Any",\n                                        "bytes": "08000000010000000000000005200000000c08f3df6e05e509000cd57646b98983481b8bcd46b98f0aae1a5abccc1e114f4000000032313266666464303430623635343935343139663430353763383339323933306534313066376266323462616565633864653539613631313762363365343563",\n                                        "parsed": null\n                                    }\n                                }\n                            }\n                        },\n                        {\n                            "key": "uref-cd0871a7e69b91a05dbf81068115e45380de3a35bd2258369e3a24b7958cd77f-000",\n                            "kind": {\n                                "Write": {\n                                    "CLValue": {\n                                        "cl_type": "U64",\n                                        "bytes": "0100000000000000",\n                                        "parsed": 1\n                                    }\n                                }\n                            }\n                        },\n                        {\n                            "key": "uref-d950666b546fe7afcf123f833ba4166b395c03bdbfd5de86dab051af3c1cdac0-000",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "message-topic-b51b0f9d94e5744af4dce6b4a9990c5f3e652c1a0a946e680e83f97d8846eff5-topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "message-b51b0f9d94e5744af4dce6b4a9990c5f3e652c1a0a946e680e83f97d8846eff5-topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1-0",\n                            "kind": {\n                                "Write": {\n                                    "Message": "message-checksum-d4854042c69aac1bc64e6f9cb2e41f306fc106f79951429d1dfef56d638be3c0"\n                                }\n                            }\n                        },\n                        {\n                            "key": "message-topic-b51b0f9d94e5744af4dce6b4a9990c5f3e652c1a0a946e680e83f97d8846eff5-topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1",\n                            "kind": {\n                                "Write": {\n                                    "MessageTopic": {\n                                        "message_count": 1,\n                                        "blocktime": 1701221761024\n                                    }\n                                }\n                            }\n                        },\n                        {\n                            "key": "uref-b6c48cfa2fa090b71912b209638b33bbf8b670a8d8a1065d73b54c70f5cc414c-000",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "deploy-09b90ada8b456e342f3209b3330c1d3bba0452d453c7f37106fed9799b280e26",\n                            "kind": {\n                                "Write": {\n                                    "DeployInfo": {\n                                        "deploy_hash": "09b90ada8b456e342f3209b3330c1d3bba0452d453c7f37106fed9799b280e26",\n                                        "transfers": [],\n                                        "from": "account-hash-212ffdd040b65495419f4057c8392930e410f7bf24baeec8de59a6117b63e45c",\n                                        "source": "uref-cfe2039aa5f3eca8a00d3444c4421e2034b77330d614b0c47c47d6af09113861-007",\n                                        "gas": "610139570"\n                                    }\n                                }\n                            }\n                        },\n                        {\n                            "key": "addressable-entity-system-f4952351cd81d38e205cd31a938b802241b70ac539d0fba5c5d2e0dc825f8944",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f4952351cd81d38e205cd31a938b802241b70ac539d0fba5c5d2e0dc825f8944",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f4952351cd81d38e205cd31a938b802241b70ac539d0fba5c5d2e0dc825f8944",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "package-42c6bbc82e3fc9dc4f890f507812a49c19aa998ed09b9d97996d9257e3c8c1c1",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f4952351cd81d38e205cd31a938b802241b70ac539d0fba5c5d2e0dc825f8944",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "balance-278862691b1d6698c02c82b302aa391f1cd10a3637e4a8c633b4560917bc607b",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f4952351cd81d38e205cd31a938b802241b70ac539d0fba5c5d2e0dc825f8944",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "account-hash-212ffdd040b65495419f4057c8392930e410f7bf24baeec8de59a6117b63e45c",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-account-a4cb74407b8da22b5dbf8cec4b2280fd2f2276bfeaa34ec64753071adf8960f5",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f5a58fd26fb2200445eb04363affcc1240cb9e1882c6a86612de41e06e1082d1",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "package-aabcd5869e1e47a6e66ca2430fcabbe9687241e55e0a070204b150771f7aef74",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f5a58fd26fb2200445eb04363affcc1240cb9e1882c6a86612de41e06e1082d1",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "balance-278862691b1d6698c02c82b302aa391f1cd10a3637e4a8c633b4560917bc607b",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "balance-cfe2039aa5f3eca8a00d3444c4421e2034b77330d614b0c47c47d6af09113861",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "balance-278862691b1d6698c02c82b302aa391f1cd10a3637e4a8c633b4560917bc607b",\n                            "kind": {\n                                "Write": {\n                                    "CLValue": {\n                                        "cl_type": "U512",\n                                        "bytes": "04df4c7928",\n                                        "parsed": "679038175"\n                                    }\n                                }\n                            }\n                        },\n                        {\n                            "key": "balance-cfe2039aa5f3eca8a00d3444c4421e2034b77330d614b0c47c47d6af09113861",\n                            "kind": {\n                                "AddUInt512": "6820961825"\n                            }\n                        },\n                        {\n                            "key": "addressable-entity-system-f5a58fd26fb2200445eb04363affcc1240cb9e1882c6a86612de41e06e1082d1",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "package-aabcd5869e1e47a6e66ca2430fcabbe9687241e55e0a070204b150771f7aef74",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "addressable-entity-system-f5a58fd26fb2200445eb04363affcc1240cb9e1882c6a86612de41e06e1082d1",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "balance-278862691b1d6698c02c82b302aa391f1cd10a3637e4a8c633b4560917bc607b",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "balance-a3fceeee68671ef97338bbe16a31782a8e262b23c52116e0c73f02a1f25d14ac",\n                            "kind": "Identity"\n                        },\n                        {\n                            "key": "balance-278862691b1d6698c02c82b302aa391f1cd10a3637e4a8c633b4560917bc607b",\n                            "kind": {\n                                "Write": {\n                                    "CLValue": {\n                                        "cl_type": "U512",\n                                        "bytes": "00",\n                                        "parsed": "0"\n                                    }\n                                }\n                            }\n                        },\n                        {\n                            "key": "balance-a3fceeee68671ef97338bbe16a31782a8e262b23c52116e0c73f02a1f25d14ac",\n                            "kind": {\n                                "AddUInt512": "679038175"\n                            }\n                        }\n                    ],\n                    "transfers": [],\n                    "cost": "610139570"\n                }\n            }\n        },\n        "messages": [\n            {\n                "entity_addr": "addressable-entity-b51b0f9d94e5744af4dce6b4a9990c5f3e652c1a0a946e680e83f97d8846eff5",\n                "message": {\n                    "String": "{\\"Mint\\":{\\"recipient\\":\\"account-hash-212ffdd040b65495419f4057c8392930e410f7bf24baeec8de59a6117b63e45c\\",\\"token_id\\":{\\"Index\\":0}}}"\n                },\n                "topic_name": "events",\n                "topic_name_hash": "topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1",\n                "index": 0\n            }\n        ]\n    }\n}\n'})}),"\n"]}),"\n",(0,t.jsx)(n.br,{}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.h3,{id:"querying-global-state",children:"Querying global state"}),"\n",(0,t.jsx)(n.p,{children:"Emitted messages are not stored in global state. However, global state stores a checksum of each message, allowing users to verify the origin and integrity of the message. The checksums in global state are unique and can be identified by the hash of the entity that emitted the message, the hash of the topic name, and the index of the message."}),"\n",(0,t.jsx)(n.p,{children:"You will find two types of stored values in global state:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The checksum of the message payload, as a 32-byte BLAKE2b hash of the serialized ",(0,t.jsx)(n.code,{children:"MessagePayload"})]}),"\n",(0,t.jsx)(n.li,{children:"The topic control record containing the number of messages sent on the topic and the timestamp of the block in which the messages were emitted"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Message key structure",src:a(51982).A+"",width:"2636",height:"730"})}),"\n",(0,t.jsxs)(n.details,{children:["\n",(0,t.jsx)(n.summary,{children:"Expand to view the sample keys"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "key": "message-b51b0f9d94e5744af4dce6b4a9990c5f3e652c1a0a946e680e83f97d8846eff5-topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1-0",\n    "kind": {\n        "Write": {\n            "Message": "message-checksum-d4854042c69aac1bc64e6f9cb2e41f306fc106f79951429d1dfef56d638be3c0"\n        }\n    }\n},\n{\n    "key": "message-topic-b51b0f9d94e5744af4dce6b4a9990c5f3e652c1a0a946e680e83f97d8846eff5-topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1",\n    "kind": {\n        "Write": {\n            "MessageTopic": {\n                "message_count": 1,\n                "blocktime": 1701221761024\n            }\n        }\n    }\n},\n'})}),"\n"]}),"\n",(0,t.jsx)(n.br,{}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.p,{children:"Here is how you can query global state to get the message checksum, given the block identifier and the composite key of the message. The message key includes the message hash, the topic name hash, and the message index."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"casper-client query-global-state \\\n--node-address <HOST:PORT> \\\n--key [HASH_STRING] \\\n--block-identifier <BLOCK_HASH> \\\n"})}),"\n",(0,t.jsx)(n.p,{children:"The arguments used above are:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node-address"})," - An IP address of a peer on the network. The default port for JSON-RPC servers on Mainnet and Testnet is 7777."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"key"})," - The identifier for the query. Use the composite key that identifies the message, i.e., message-CONTRACT_HASH-topic-name-TOPIC_HASH-MESSAGE_INDEX."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"block-identifier"})," - Hex-encoded block hash or height of the block."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here is a sample query to view the message checksum:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'casper-client query-global-state --node-address http://127.0.0.1:11101 \\\n--key "message-803c759a466a84a0ab12147857f49e269369796a66ad37e94ab8343ddddb7823-topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1-0" \\\n--block-identifier d9642c5d90c7fc05a23d83a3abcf56d63cb71316402ecefe0962fdeccad2c99c\n'})}),"\n",(0,t.jsxs)(n.details,{children:["\n",(0,t.jsx)(n.summary,{children:"Expand to view the sample response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "id": 3085511981091403408,\n  "result": {\n    "api_version": "1.0.0",\n    "block_header": {\n      "Version2": {\n        "parent_hash": "e55e5127ec6ed5ac03767f9d8b0d0dbd434df81c03658dcc5d9f17b780de980a",\n        "state_root_hash": "e033c27db66a4542b53477c97c4f9176ffce72ab6edebd6fdb25b2fe0aa70fe8",\n        "body_hash": "ba26e345470f6322f39810e8408fff666026276dee72cbb9fa85ec55657070fb",\n        "random_bit": false,\n        "accumulated_seed": "caf392ee00d60d9729c8e042acbd851ff70be47b0e8a317cc728b3be47a815ce",\n        "era_end": null,\n        "timestamp": "2023-12-02T01:19:12.384Z",\n        "era_id": 84,\n        "height": 890,\n        "protocol_version": "1.0.0"\n      }\n    },\n    "stored_value": {\n      "Message": "message-checksum-56098444c4f0dff8f321cfa3769d400f4b5bfa9e01e6ad6b147d81b87130bfb9"\n    },\n    "merkle_proof": "[1336 hex chars]"\n  }\n}\n'})}),"\n"]}),"\n",(0,t.jsx)(n.br,{}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.p,{children:"Emitted messages are temporary by design. Sometimes, message checksums are pruned from global state to manage storage. Pruning of old message records for a particular contract only happens if the contract emits messages again in a new block. Otherwise, the last entries from the time the contract was last executed are still retained in global state. Applications can query old checksums using the state root hash of the block that contains them."}),"\n",(0,t.jsxs)(n.details,{children:["\n",(0,t.jsx)(n.summary,{children:"Expand to view an example"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Let's assume we have a contract that executes in a block with block time 1 and emits 100 messages."}),"\n",(0,t.jsx)(n.li,{children:"If we query the global state at the root hash of the block with block time 1, then we will see a control struct for the topic indicating message count 100 and block time 1."}),"\n",(0,t.jsx)(n.li,{children:"Let's assume the contract executes in another block with block time 2 and emits 50 messages."}),"\n",(0,t.jsx)(n.li,{children:"Then, if we query the global state at the root hash of the block at block time 2, we will see message count 50 and block time 2."}),"\n",(0,t.jsx)(n.li,{children:"Let's assume 3 blocks go by, and the contract doesn't execute in those blocks (block time 3, 4, 5)."}),"\n",(0,t.jsx)(n.li,{children:"If we query the global state at the root hash of the block at block time 5, we will see message count 50 and block time 2."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here is how you can determine the number of messages emitted in a particular block:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"casper-client query-global-state \\\n--node-address <HOST:PORT> \\\n--key [HASH_STRING] \\\n--block-identifier <BLOCK_HASH> \\\n"})}),"\n",(0,t.jsx)(n.p,{children:"The arguments used above are:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node-address"})," - An IP address of a peer on the network. The default port for JSON-RPC servers on Mainnet and Testnet is 7777."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"key"})," - The identifier for the query. Use the composite key that identifies the message topic, e.g., message-topic-CONTRACT_HASH-topic-name-TOPIC_HASH."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"block-identifier"})," - Hex-encoded block hash or height of the block."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here is a sample query to view the message topic:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'casper-client query-global-state --node-address http://127.0.0.1:11101 \\\n--key "message-topic-803c759a466a84a0ab12147857f49e269369796a66ad37e94ab8343ddddb7823-topic-name-5721a6d9d7a9afe5dfdb35276fb823bed0f825350e4d865a5ec0110c380de4e1" \\\n--block-identifier d9642c5d90c7fc05a23d83a3abcf56d63cb71316402ecefe0962fdeccad2c99c\n'})}),"\n",(0,t.jsxs)(n.details,{children:["\n",(0,t.jsx)(n.summary,{children:"Expand to view the sample response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "id": 1227453659579324378,\n  "result": {\n    "api_version": "1.0.0",\n    "block_header": {\n      "Version2": {\n        "parent_hash": "e55e5127ec6ed5ac03767f9d8b0d0dbd434df81c03658dcc5d9f17b780de980a",\n        "state_root_hash": "e033c27db66a4542b53477c97c4f9176ffce72ab6edebd6fdb25b2fe0aa70fe8",\n        "body_hash": "ba26e345470f6322f39810e8408fff666026276dee72cbb9fa85ec55657070fb",\n        "random_bit": false,\n        "accumulated_seed": "caf392ee00d60d9729c8e042acbd851ff70be47b0e8a317cc728b3be47a815ce",\n        "era_end": null,\n        "timestamp": "2023-12-02T01:19:12.384Z",\n        "era_id": 84,\n        "height": 890,\n        "protocol_version": "1.0.0"\n      }\n    },\n    "stored_value": {\n      "MessageTopic": {\n        "message_count": 1,\n        "blocktime": 1701479952384\n      }\n    },\n    "merkle_proof": "[1288 hex chars]"\n  }\n}\n'})}),"\n"]}),"\n",(0,t.jsx)(n.br,{}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"The message payload cannot be reconstructed by reading the entry from global state since that entry contains only the checksum of the messages sent."})}),"\n",(0,t.jsx)(n.h2,{id:"costs-and-chainspec-settings",children:"Costs and Chainspec Settings"}),"\n",(0,t.jsxs)(n.p,{children:["The following chainspec settings manage the cost of contract-level messages. These limits are bundled into the Wasm configuration settings under the ",(0,t.jsx)(n.code,{children:"wasm.messages_limits"}),". Consult the chainspec of the network you are working with, as the following are only examples."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:"[wasm.messages_limits]\n# Maximum size of the topic name.\nmax_topic_name_size = 256\n# Maximum number of topics that can be added for each contract.\nmax_topics_per_contract = 128\n# Maximum size in bytes of the serialized message payload.\nmax_message_size = 1_024\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Since contract-level messages are handled through FFIs, the gas cost related to using the new interface is captured in the ",(0,t.jsx)(n.code,{children:"wasm.host_function_costs"})," chainspec settings:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:"[wasm.host_function_costs]\nmanage_message_topic = { cost = 200, arguments = [0, 0, 0, 0] }\nemit_message = { cost = 200, arguments = [0, 0, 0, 0] }\ncost_increase_per_message = 50\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"cost_increase_per_message"})," setting increases the gas cost for each subsequent message when emitting multiple messages within a single execution. In the example above, within a single execution, the first message will cost 200 motes, the second will cost 250 motes, and so on. Each subsequent call will increase the gas cost by the value specified under the ",(0,t.jsx)(n.code,{children:"cost_increase_per_message"})," setting. The subsequent execution will start from the base cost specified in the ",(0,t.jsx)(n.code,{children:"emit_message"})," setting; in this case, the following execution will start at 200 motes."]}),"\n",(0,t.jsxs)(n.p,{children:["Storage is charged based on the ",(0,t.jsx)(n.code,{children:"wasm.storage_costs.gas_per_byte"})," chainspec parameter.\nWhen a new topic is added, two records are written in global state: the topic control record and the addressable entity record extended with the new topic name and topic name hash. Because the topic name is variable, the cost depends on the length of the topic name.\nWhen a message is emitted, two records are written in global state: the topic control record and the message checksum. Writing these records incurs a fixed cost based on ",(0,t.jsx)(n.code,{children:"gas_per_byte"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"topic-management-during-contract-upgrades",children:"Topic Management during Contract Upgrades"}),"\n",(0,t.jsx)(n.p,{children:"When a new contract version is added to the contract package, the message topics registered from the previous version are automatically carried over to the new contract. A new control record will be written for each topic for the new contract version."}),"\n",(0,t.jsx)(n.h2,{id:"whats-next",children:"What's Next?"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Learn to ",(0,t.jsx)(n.a,{href:"/docs-redux/next/developers/cli/installing-contracts",children:"install a contract and query global state"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Learn to ",(0,t.jsx)(n.a,{href:"/docs-redux/next/developers/dapps/monitor-and-consume-events",children:"monitor and consume the event stream"}),"."]}),"\n"]})]})}function b(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(f,{...e})}):f(e)}},51982:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/message_keys-f4d30d684fcb186bbc91625a10f2870a.png"},28453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>i});var t=a(96540);const c={},d=t.createContext(c);function s(e){const n=t.useContext(d);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),t.createElement(d.Provider,{value:n},e.children)}}}]);