"use strict";(self.webpackChunkcspr_docs=self.webpackChunkcspr_docs||[]).push([[4054],{96738:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>d});var a=i(74848),r=i(28453);const t={title:"validator rewards in Casper 2.0",description:"A discussion of validator rewards under Casper 2.0",slug:"condor-validator-rewards",date:"2024-08-20T18:00",authors:["melpadden","alexanderlimonov"],tags:["condor","validators"],hide_table_of_contents:!1},o="Validator rewards with Casper 2.0",s={permalink:"/docs-redux/blog/condor-validator-rewards",source:"@site/blog/2024-08-20-validator-rewards.md",title:"validator rewards in Casper 2.0",description:"A discussion of validator rewards under Casper 2.0",date:"2024-08-20T18:00:00.000Z",tags:[{inline:!1,label:"Condor",permalink:"/docs-redux/blog/tags/condor",description:"Blog posts related to the Condor upgrade"},{inline:!0,label:"validators",permalink:"/docs-redux/blog/tags/validators"}],readingTime:6.88,hasTruncateMarker:!1,authors:[{name:"Mel Padden",page:{permalink:"/docs-redux/blog/authors/melpadden"},title:"Head of Developer Relations for Casper Association",url:"https://github.com/melpadden",socials:{x:"https://x.com/mel_casper"},permalink:"/melpadden",imageURL:"https://github.com/melpadden.png",key:"melpadden"},{name:"Alexander Limonov",page:{permalink:"/docs-redux/blog/authors/alexanderlimonov"},title:"Economist for Casper Labs",url:"https://github.com/AlexanderLimonov",permalink:"/alexanderlimonov",imageURL:"https://github.com/AlexanderLimonov.png",key:"alexanderlimonov"}],frontMatter:{title:"validator rewards in Casper 2.0",description:"A discussion of validator rewards under Casper 2.0",slug:"condor-validator-rewards",date:"2024-08-20T18:00",authors:["melpadden","alexanderlimonov"],tags:["condor","validators"],hide_table_of_contents:!1},unlisted:!1,nextItem:{title:"Casper Docs Redux!",permalink:"/docs-redux/blog/welcome-docs-redux"}},l={authorsImageUrls:[void 0,void 0]},d=[{value:"Economics of consensus",id:"economics-of-consensus",level:2},{value:"Casper 1.X Highway-specific incentives",id:"casper-1x-highway-specific-incentives",level:2},{value:"Casper 2.0",id:"casper-20",level:2},{value:"Public knowledge of finality",id:"public-knowledge-of-finality",level:3},{value:"Design",id:"design",level:3},{value:"Expected rewards &amp; volatility",id:"expected-rewards--volatility",level:4},{value:"Rewards formula",id:"rewards-formula",level:4},{value:"Notes on implementation",id:"notes-on-implementation",level:4},{value:"Impact on validator revenue",id:"impact-on-validator-revenue",level:3}];function c(e){const n={em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"economics-of-consensus",children:"Economics of consensus"}),"\n",(0,a.jsx)(n.p,{children:"Proof of Stake consensus protocols explicitly impose an assumption that a critical portion of the validator set, by weight, remains honest. Normally, just as it is in Highway and will be in Zug, there is a requirement that at least 2/3 of the weight remain honest for the chain to continue to operate normally."}),"\n",(0,a.jsx)(n.p,{children:"Proof of Stake protocols do not typically describe the particular incentives that should keep validators honest, however, so some incentive scheme must be independently developed to ensure that the assumptions of the safety and liveness theorems actually hold. Such a scheme may directly reward some measure of performance within the protocol model, but an alternative model can choose to reward consensus-independent measures of chain performance, such as chain progress."}),"\n",(0,a.jsx)(n.p,{children:"Incentive rewards in Casper come from issuance of new token at the end of each era, with quantity derived from an inflation parameter in the chainspec. The minted token are distributed in proportion to weight, assuming nominal performance of the chain."}),"\n",(0,a.jsx)(n.h2,{id:"casper-1x-highway-specific-incentives",children:"Casper 1.X Highway-specific incentives"}),"\n",(0,a.jsx)(n.p,{children:"The 1.0 rewards scheme introduced with Highway on mainnet is directly tied to the details of Highway consensus. Rewards are maximized when all validators regularly send messages necessary to finalize a block within a time limit in a particular round."}),"\n",(0,a.jsx)(n.p,{children:"Degrading platform performance by delaying block finalization is disadvantageous for all validators, even those not directly responsible for the delay, which is a means of aligning validator incentives with each other by discouraging censorship of consensus messages produced by others."}),"\n",(0,a.jsx)(n.p,{children:"The weakness of the 1.0 rewards model is that it is difficult to understand and maintain. Additionally, by focusing on a consensus-specific measure of performance, it does not directly incentivize the observable outcome that we actually care about, which is public knowledge of block finality."}),"\n",(0,a.jsx)(n.h2,{id:"casper-20",children:"Casper 2.0"}),"\n",(0,a.jsx)(n.h3,{id:"public-knowledge-of-finality",children:"Public knowledge of finality"}),"\n",(0,a.jsx)(n.p,{children:"A necessary outcome of a safe consensus process over possible histories of the chain is that all honest validators should have at least mutual knowledge of the canonical history. That is, each honest validator should believe that a particular history is the correct one, and this history should be the same for all validators."}),"\n",(0,a.jsx)(n.p,{children:"This mutual knowledge is sufficient for validators to make further progress in building up the canonical history. However, for a user of the blockchain, establishing confidence in the correct operation of the protocol and the identity of the canonical history requires that the validators' knowledge of the canonical history be attested publicly."}),"\n",(0,a.jsx)(n.p,{children:"In Casper, validators create and distribute finality signatures, which are cryptographically secure witnesses of their belief in the finality of a particular block. Under 1.X, however, these are not easily verifiable by users and play no role in the reward mechanism, despite being a critical tool for building user confidence in the canonical history. In 2.0, we propose to allocate rewards for creation and publication of one's own and other validators' finality signatures."}),"\n",(0,a.jsx)(n.h3,{id:"design",children:"Design"}),"\n",(0,a.jsx)(n.p,{children:"Rewards that promote public knowledge of finality naturally suggest rewarding publicly observable behaviors, rather than metrics only readily visible to the consensus component. This, together with the expected transition from Highway to Zug, naturally led to a system that rewards three publicly observable activities"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Block proposal"}),"\n",(0,a.jsx)(n.li,{children:"Signature creation"}),"\n",(0,a.jsx)(n.li,{children:"Signature publication"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Note that we expect very little, if any, rewards to be allocated for block proposals on mainnet, but the feature remains available."}),"\n",(0,a.jsx)(n.p,{children:'The rewards apportioned to a block, under nominal operating conditions, are the same as they are under 1.X, that is, they amount to total supply at last era\'s end multiplied by an inflation factor derived from the chainspec. "Nominal" here means that all rounds result in a finalized block and that all finality signatures are collected and published.'}),"\n",(0,a.jsx)(n.p,{children:"The rewards are apportioned to these three activities based on chainspec settings governing the split between block proposals and signature rewards, and, within signature rewards, between finality signature creation and publication."}),"\n",(0,a.jsx)(n.p,{children:"Note that this split ensures that validators' incentives are aligned, in the sense that other validators' correct operation is beneficial for each validator. This is because each validator is rewarded for publishing other validators' signature, and because each validator benefits from other publishing its own signatures."}),"\n",(0,a.jsx)(n.h4,{id:"expected-rewards--volatility",children:"Expected rewards & volatility"}),"\n",(0,a.jsx)(n.p,{children:"Under nominal operating conditions, the total rewards for each validator will be proportional to weight in the long run. Depending on the particular values of the parameters governing the split between the three components of the rewards, short-run rewards can be more or less variable."}),"\n",(0,a.jsx)(n.p,{children:"In the long run, with a stable validator set, each validator eventually produces a number of blocks proportional to its weight. Small validators can do months between producing a block, and will experience variable wait times between such occasions. However, each validator is supposed to produce signatures for each finalized block, so moving the allocation towards signature creation can reduce volatility."}),"\n",(0,a.jsx)(n.h4,{id:"rewards-formula",children:"Rewards formula"}),"\n",(0,a.jsx)(n.p,{children:"The rewards have three additive components, one for each observable activity we described in the previous section. The era rewards for a particular validator can be described using a simple formula, given below. Note that the formula does not exactly correspond to the actual on-chain calculation, for technical reasons we discuss in a further section."}),"\n",(0,a.jsx)(n.p,{children:"Let us define some notation first"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"N"})," - expected number of blocks in an era"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"N"}),"* - the ",(0,a.jsx)(n.em,{children:"set"})," of observed blocks in an era"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"R"})," - total potential reward pot for the era (i.e., nominal inflation based on chainspec and current supply)"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"r"})," - fraction of reward pot dedicated to block production rewards"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"f"})," - finder's fee for finality signatures"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"I"})," - validator index set"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"i"}),": ",(0,a.jsx)(n.strong,{children:"N"}),"* -> {0,1} - indicator function for blocks produced by validator i (with abuse of notation)"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"w"}),": ",(0,a.jsx)(n.strong,{children:"I"})," -> [0,1] - validator's weight"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"W"})," - total weight of the validator set"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"S"}),": ",(0,a.jsx)(n.strong,{children:"N"}),"* -> ",(0,a.jsx)(n.strong,{children:"P(I)"})," - set of validators associated with finality signatures for a particular observed block"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"s_i"}),": ",(0,a.jsx)(n.strong,{children:"N"}),"* -> {0,1} - indicator functions for existence of finality signatures associated with validator i for particular observed blocks"]}),"\n",(0,a.jsx)(n.p,{children:"Now, we can use our defined symbols to concisely describe era rewards for a particular validator"}),"\n",(0,a.jsx)(n.p,{children:"Era rewards for validator i ="}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u03a3"})," (n in ",(0,a.jsx)(n.strong,{children:"N"}),"*) ",(0,a.jsx)(n.strong,{children:"i(n)"})," * (",(0,a.jsx)(n.strong,{children:"rR/N"}),") (block production)"]}),"\n",(0,a.jsxs)(n.p,{children:["+ ",(0,a.jsx)(n.strong,{children:"\u03a3"})," (n in ",(0,a.jsx)(n.strong,{children:"N"}),"*) ",(0,a.jsx)(n.strong,{children:"i(n)"})," * ",(0,a.jsx)(n.strong,{children:"\u03a3"})," (j in ",(0,a.jsx)(n.strong,{children:"S(n)"}),") (",(0,a.jsx)(n.strong,{children:"w(j)/W"}),") * (",(0,a.jsx)(n.strong,{children:"f(1-r)R/N"}),") (finality signature publication)"]}),"\n",(0,a.jsxs)(n.p,{children:["+ ",(0,a.jsx)(n.strong,{children:"\u03a3"})," (n in ",(0,a.jsx)(n.strong,{children:"N"}),"*) ",(0,a.jsx)(n.strong,{children:"s_i(n)"})," * (",(0,a.jsx)(n.strong,{children:"w(i)/W"}),") * (",(0,a.jsx)(n.strong,{children:"(1-f)(1-r)R/N"}),") (finality signature contribution)"]}),"\n",(0,a.jsx)(n.p,{children:"The meanings of the three additive components in the formula above are, in order"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Sum over blocks, discarding blocks not proposed by this validator\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"For each block, add the per-block reward allocation for block proposals from the total pot for the era"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Sum over blocks, discarding blocks not proposed by this validator\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["For each block, sum over published signatures\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"For each signature, add the per-block reward allocation for signature publication from the total pot for the era, weighing each signature by its creator's proportion of total validator weight"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Sum over blocks, discarding those for which this validator did not create a signature\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"For each block, add the per-block reward allocation for signature creation from the total pot for the era, weighing it by the validator's proportion of total validator weight"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"notes-on-implementation",children:"Notes on implementation"}),"\n",(0,a.jsx)(n.p,{children:"In a real network, messages arrive with a delay. This means that we cannot guarantee that all finality signatures for an era will arrive in time to be used by the rewards calculation carried out in the switch block."}),"\n",(0,a.jsx)(n.p,{children:"We solve this problem by allowing publication of finality signatures for a preceding era. As long as the validator set stays unchanged, in the long run the formula above is a near-exact representation of rewards."}),"\n",(0,a.jsx)(n.p,{children:"However, entry of new validators means that some of the publication rewards may be distributed among more validators than just those who participated in the era in which the signatures were created."}),"\n",(0,a.jsx)(n.h3,{id:"impact-on-validator-revenue",children:"Impact on validator revenue"}),"\n",(0,a.jsx)(n.p,{children:"No impact is expected on average validator rewards under nominal operating conditions. Note that shortfall in signature creation, or network issues preventing the propagation of such signatures, can reduce rewards, even for validators who honestly publish all incoming signatures and honestly create signatures for each block. Additionally, allocating more rewards to block proposals or finality publication can make the rewards more volatile."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>s});var a=i(96540);const r={},t=a.createContext(r);function o(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);